include/rpl/init_source_replica.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.
[connection master]
CREATE TABLE t1 (a INT);
CREATE TABLE t2 (a INT);
CREATE TABLE t3 (a INT);
CREATE TABLE t4 (a INT);
include/sync_slave_sql_with_master.inc
[connection master]

#
# Test-1: Dropping tables from the connection which has
#         binlog_ddl_skip_rewrite=ON
#
SET binlog_ddl_skip_rewrite = ON;
<<<<<<< HEAD
DROP /* comment1 */ TABLE t1;
include/mysqlbinlog.inc
Executed query: DROP /* comment1 */ TABLE t1
Logged query: DROP /* comment1 */ TABLE t1
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=1*//*!*/;

#
# Test-2: Dropping tables from the connection which has
#         binlog_ddl_skip_rewrite=ON
#
[connection master1]
DROP /* comment2 */ TABLE t2;
include/mysqlbinlog.inc
Executed query: DROP /* comment2 */ TABLE t2
Logged query: DROP TABLE `t2` /* generated by server */
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=0*//*!*/;

#
# Test-3: Continue dropping tables from the connection which has
#         binlog_ddl_skip_rewrite=ON
#
[connection master]
DROP /* comment3 */ TABLE t3;
include/mysqlbinlog.inc
Executed query: DROP /* comment3 */ TABLE t3
Logged query: DROP /* comment3 */ TABLE t3
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=1*//*!*/;

#
# Test-4: Dropping tables from the connection which has
#         binlog_ddl_skip_rewrite=OFF
#
SET binlog_ddl_skip_rewrite = OFF;
DROP /* comment4 */ TABLE t4;;
include/mysqlbinlog.inc
Executed query: DROP /* comment4 */ TABLE t4;
Logged query: DROP TABLE `t4` /* generated by server */
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=0*//*!*/;
include/show_binlog_events.inc
||||||| merged common ancestors
create table t1 (a int);
drop /* drop comments */ table t1;
include/show_binlog_events.inc
=======
create table t1 (a int);
drop /* drop comments */ table t1;
include/rpl/deprecated/show_binlog_events.inc
>>>>>>> Percona-Server-8.4.0-1
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
<<<<<<< HEAD
master-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t1 (a INT)
master-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t2 (a INT)
master-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t3 (a INT)
master-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t4 (a INT)
master-bin.000001	#	Query	#	#	use `test`; DROP /* comment1 */ TABLE t1
master-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t2` /* generated by server */
master-bin.000001	#	Query	#	#	use `test`; DROP /* comment3 */ TABLE t3
master-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t4` /* generated by server */
include/sync_slave_sql_with_master.inc
include/show_binlog_events.inc
||||||| merged common ancestors
master-bin.000001	#	Query	#	#	use `test`; create table t1 (a int)
master-bin.000001	#	Query	#	#	use `test`; drop /* drop comments */ table t1
SET binlog_ddl_skip_rewrite = OFF;
include/sync_slave_sql_with_master.inc
include/show_binlog_events.inc
=======
master-bin.000001	#	Query	#	#	use `test`; create table t1 (a int)
master-bin.000001	#	Query	#	#	use `test`; drop /* drop comments */ table t1
SET binlog_ddl_skip_rewrite = OFF;
include/rpl/sync_to_replica.inc
include/rpl/deprecated/show_binlog_events.inc
>>>>>>> Percona-Server-8.4.0-1
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
<<<<<<< HEAD
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t1 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t2 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t3 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t4 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; DROP /* comment1 */ TABLE t1
slave-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t2` /* generated by server */
slave-bin.000001	#	Query	#	#	use `test`; DROP /* comment3 */ TABLE t3
slave-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t4` /* generated by server */

#
# Test-5: Binlog replay
#
[connection master]
# Dump the binlog events into a file.
include/mysqlbinlog.inc
[connection slave]
include/stop_slave.inc
RESET BINARY LOGS AND GTIDS;
include/start_slave.inc
# Perform the replay.
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t1 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t2 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t3 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t4 (a INT)
slave-bin.000001	#	Query	#	#	use `test`; DROP /* comment1 */ TABLE t1
slave-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t2` /* generated by server */
slave-bin.000001	#	Query	#	#	use `test`; DROP /* comment3 */ TABLE t3
slave-bin.000001	#	Query	#	#	use `test`; DROP TABLE `t4` /* generated by server */
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=1*//*!*/;
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=0*//*!*/;
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=1*//*!*/;
include/mysqlbinlog.inc
Output: /*!80026 SET @@session.binlog_ddl_skip_rewrite=0*//*!*/;
include/rpl_end.inc
||||||| merged common ancestors
slave-bin.000001	#	Query	#	#	use `test`; create table t1 (a int)
slave-bin.000001	#	Query	#	#	use `test`; drop /* drop comments */ table t1
include/rpl_end.inc
=======
slave-bin.000001	#	Query	#	#	use `test`; create table t1 (a int)
slave-bin.000001	#	Query	#	#	use `test`; drop /* drop comments */ table t1
include/rpl/deinit.inc
>>>>>>> Percona-Server-8.4.0-1
