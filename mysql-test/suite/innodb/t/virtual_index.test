--source include/have_innodb.inc
--source include/have_innodb_max_16k.inc
--echo #
--echo # Bug 21922176 - PREBUILT->SEARCH_TUPLE CREATED WITHOUT INCLUDING
--echo # THE NUMBER OF VIRTUAL COLUMNS
--echo #

CREATE TABLE t1 (a INT, a1 INT GENERATED ALWAYS AS (a) VIRTUAL, a2 INT
GENERATED ALWAYS AS (a) VIRTUAL, a3 INT GENERATED ALWAYS AS (a) VIRTUAL, a4
INT GENERATED ALWAYS AS (a) VIRTUAL, a5 INT GENERATED ALWAYS AS (a) VIRTUAL,
a6 INT GENERATED ALWAYS AS (a) VIRTUAL, a7 INT GENERATED ALWAYS AS (a)
VIRTUAL, a8 INT GENERATED ALWAYS AS (a) VIRTUAL, a9 INT GENERATED ALWAYS AS
(a) VIRTUAL, INDEX(a1, a2, a3, a4, a5, a6, a7, a8, a9)) ;

INSERT INTO t1(a) VALUES(10);

SELECT * FROM t1 WHERE a1=10 AND a2 = 10 AND a3 =10 AND a4 = 10 AND a5=10 AND
a6=10 AND a7=10 AND a8=10 AND a9=10;

DROP TABLE t1;

--echo #
--echo # Bug 22572997 - GCOL:INNODB: FAILING ASSERTION: N < REC_OFFS_N_FIELDS(
--echo # OFFSETS)
--echo #
SET @@SESSION.sql_mode=0;

CREATE TABLE t1(
c1 int(1)AUTO_INCREMENT,
	c2 int(1),
	c3 int(1)GENERATED ALWAYS AS ((c2 + c2)) VIRTUAL,
	c4 int(1)GENERATED ALWAYS AS ((c3 + c2)) VIRTUAL,
	c5 date,
	c6 date GENERATED ALWAYS AS((c5 + interval 30 day)) VIRTUAL,
	c7 DATE,
	c8 time,
	c9 DATE GENERATED ALWAYS AS(addtime(c7,c8)) VIRTUAL,
	c10 time GENERATED ALWAYS AS(addtime(c7,c8)) VIRTUAL,
	c11 DATE GENERATED ALWAYS AS(addtime(c9,c8)) VIRTUAL,
	c12 CHAR(1),
	c13 CHAR(1)GENERATED ALWAYS AS (concat(c12,c12)) VIRTUAL,
	c14 CHAR(2)GENERATED ALWAYS AS (concat(c13,'x')) VIRTUAL,
	PRIMARY KEY(c1),
	KEY c4_6(c4,c11)
)ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE t2(
	c1 int(1)AUTO_INCREMENT,
	c2 int(1),
	c3 int(1)GENERATED ALWAYS AS ((c2 + c2)) VIRTUAL,
	c4 int(1)GENERATED ALWAYS AS ((c3 + c2)) VIRTUAL,
	c5 date,
	c6 date GENERATED ALWAYS AS((c5 + interval 30 day)) VIRTUAL,
	c6a date GENERATED ALWAYS AS((c6 + interval 30 day)) VIRTUAL,
	c7 DATE,
	c8 time,
	c9 DATE GENERATED ALWAYS AS(addtime(c7,c8)) VIRTUAL,
	c10 time GENERATED ALWAYS AS(addtime(c7,c8)) VIRTUAL,
	c11 DATE GENERATED ALWAYS AS(addtime(c9,c8)) VIRTUAL,
	c11a time GENERATED ALWAYS AS(addtime(c7,c10)) VIRTUAL,
	c12 CHAR(1),
	c13 CHAR(2)GENERATED ALWAYS AS (concat(c12,c12)) VIRTUAL,
	c14 CHAR(4)GENERATED ALWAYS AS (concat(c13,'x')) VIRTUAL,
	PRIMARY KEY(c1),
	KEY c13(c13),
	KEY c4_6(c4,c11)
)ENGINE=InnoDB DEFAULT CHARSET=latin1;
INSERT INTO t2(c1,c2,c5,c7,c8,c12)VALUES (0,0,0,0,0,'v');

CREATE TABLE t3(
	c1 int(1)AUTO_INCREMENT,
	c2 int(1),
	c3 int(1)GENERATED ALWAYS AS ((c2 + c2)) VIRTUAL,
	c4 int(1)GENERATED ALWAYS AS ((c3 + c2)) VIRTUAL,
	c5 date,
	c7 DATE,
	c8 time,
	c9 DATE GENERATED ALWAYS AS(addtime(c7,c8)) VIRTUAL,
	c11 DATE GENERATED ALWAYS AS(addtime(c9,c8)) VIRTUAL,
	c12 CHAR(1),
	PRIMARY KEY(c1),
	KEY c4_6(c4,c11)
)ENGINE=InnoDB DEFAULT CHARSET=latin1;
INSERT INTO t3(c1,c2,c5,c7,c8,c12)VALUES
(0,0,0,0,0,'q'),(0,0,0,0,0,'g'),(0,0,0,0,0,'l'),(0,0,0,0,0,1),(0,0,0,0,0,'v'),
(0,1,0,0,0,'c'),(0,0,0,0,0,'x');

UPDATE
t2 AS O1,t3 AS O2
SET O1.c12=1
WHERE O1.c14 NOT IN
(
SELECT
DISTINCT I1.c14 AS y
FROM t1 AS I1
ORDER BY I1.c14);

SET @@SESSION.sql_mode=default;

DROP TABLE t1, t2, t3;

--echo #
--echo # Bug 22650296 - ASSERTION IN INNOBASE_BUILD_COL_MAP, ALTER
--echo #
CREATE TABLE `ibstd_08` (
 `nc00577` tinyint(4) DEFAULT NULL,
  `nc07844` varchar(41) DEFAULT NULL,
  `gc01908` point NOT NULL,
  `nc04156` char(17) DEFAULT NULL,
  `nc09536` longblob NOT NULL,
  `nc09231` decimal(10,0) NOT NULL,
  `a` int(11) NOT NULL,
  `b` varchar(198) NOT NULL,
  `nc04560` mediumtext,
  `c` char(187) DEFAULT NULL,
  `vbidxcol` char(3) GENERATED ALWAYS AS (substr(`b`,1,3)) VIRTUAL,
  `gc00881` polygon NOT NULL,
  `nc05121` int(11) NOT NULL DEFAULT '85941481',
  KEY `a` (`a`),
  KEY `b` (`b`(3),`a`),
  KEY `c` (`c`(99),`b`(25)),
  KEY `b_2` (`b`(5),`c`(10),`a`),
  KEY `vbidxcol` (`vbidxcol`),
  KEY `a_2` (`a`,`vbidxcol`),
  KEY `vbidxcol_2` (`vbidxcol`),
  FULLTEXT KEY `ftsic` (`c`,`b`)
) ENGINE=InnoDB;


ALTER TABLE ibstd_08  ADD COLUMN nc07006 BIGINT  AUTO_INCREMENT NOT NULL  , ADD KEY auto_nc07006(nc07006);

DROP TABLE ibstd_08;
